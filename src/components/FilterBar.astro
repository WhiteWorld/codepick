---
import { t, type Locale } from '../lib/i18n';

interface Props {
  tags: string[];
  activeTag?: string;
  lang?: Locale;
}

const { tags, activeTag = 'all', lang = 'zh' } = Astro.props;
---

<div class="flex flex-wrap gap-2" id="filter-bar">
  {tags.map(tag => (
    <button
      class={`filter-chip ${tag === activeTag ? 'active' : ''}`}
      data-filter={tag}
    >
      {t(`tag.${tag}`, lang) || tag}
    </button>
  ))}
</div>

<script>
  document.querySelectorAll('#filter-bar .filter-chip').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('#filter-bar .filter-chip').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      const filter = (btn as HTMLElement).dataset.filter || 'all';

      document.querySelectorAll('[data-plan-tags]').forEach(card => {
        const el = card as HTMLElement;
        const tags = el.dataset.planTags?.split(',') || [];
        if (filter === 'all' || tags.includes(filter)) {
          el.style.display = '';
        } else {
          el.style.display = 'none';
        }
      });
    });
  });
</script>
