---
// 30 ç§’å¿«é€Ÿé€‰å‹å™¨
---

<div class="card p-6 md:p-8" id="quick-picker">
  <h2 class="text-xl font-bold text-white mb-2 mt-0">âš¡ 30 ç§’å¿«é€Ÿé€‰å‹</h2>
  <p class="text-sm text-[var(--text-muted)] mb-6">å›ç­” 3 ä¸ªé—®é¢˜ï¼Œæ‰¾åˆ°æœ€é€‚åˆä½ çš„æ–¹æ¡ˆ</p>

  <!-- Step 1 -->
  <div class="picker-step" data-step="1">
    <p class="text-sm font-medium text-[var(--text-secondary)] mb-3">1/3 Â· ä½ çš„ä¸»åŠ›å¼€å‘ç¯å¢ƒæ˜¯ï¼Ÿ</p>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
      <button class="picker-option btn btn-ghost justify-center" data-key="env" data-value="vscode">VS Code</button>
      <button class="picker-option btn btn-ghost justify-center" data-key="env" data-value="jetbrains">JetBrains</button>
      <button class="picker-option btn btn-ghost justify-center" data-key="env" data-value="terminal">ç»ˆç«¯ / Vim</button>
      <button class="picker-option btn btn-ghost justify-center" data-key="env" data-value="any">éƒ½å¯ä»¥</button>
    </div>
  </div>

  <!-- Step 2 -->
  <div class="picker-step hidden" data-step="2">
    <p class="text-sm font-medium text-[var(--text-secondary)] mb-3">2/3 Â· ä½ çš„æœˆé¢„ç®—æ˜¯ï¼Ÿ</p>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
      <button class="picker-option btn btn-ghost justify-center" data-key="budget" data-value="free">Â¥0 å…è´¹</button>
      <button class="picker-option btn btn-ghost justify-center" data-key="budget" data-value="low">Â¥10-50</button>
      <button class="picker-option btn btn-ghost justify-center" data-key="budget" data-value="mid">Â¥50-150</button>
      <button class="picker-option btn btn-ghost justify-center" data-key="budget" data-value="high">ä¸é™é¢„ç®—</button>
    </div>
  </div>

  <!-- Step 3 -->
  <div class="picker-step hidden" data-step="3">
    <p class="text-sm font-medium text-[var(--text-secondary)] mb-3">3/3 Â· ä½ æœ€çœ‹é‡ä»€ä¹ˆï¼Ÿ</p>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
      <button class="picker-option btn btn-ghost justify-center" data-key="priority" data-value="power">ç¼–ç¨‹èƒ½åŠ›æœ€å¼º</button>
      <button class="picker-option btn btn-ghost justify-center" data-key="priority" data-value="cheap">æ€§ä»·æ¯”æœ€é«˜</button>
      <button class="picker-option btn btn-ghost justify-center" data-key="priority" data-value="china">å›½å†…ä½“éªŒå¥½</button>
      <button class="picker-option btn btn-ghost justify-center" data-key="priority" data-value="flex">çµæ´»å¯å®šåˆ¶</button>
      <button class="picker-option btn btn-ghost justify-center" data-key="priority" data-value="privacy">æ•°æ®éšç§</button>
      <button class="picker-option btn btn-ghost justify-center" data-key="priority" data-value="easy">å¼€ç®±å³ç”¨</button>
    </div>
  </div>

  <!-- Result -->
  <div class="picker-step hidden" data-step="result">
    <div class="text-center py-4">
      <p class="text-sm text-[var(--text-muted)] mb-2">ğŸ¯ æ¨èæ–¹æ¡ˆ</p>
      <div id="picker-result" class="text-xl font-bold text-white">è®¡ç®—ä¸­...</div>
      <p id="picker-reason" class="text-sm text-[var(--text-muted)] mt-2"></p>
      <button class="btn btn-ghost mt-4" id="picker-reset">é‡æ–°é€‰æ‹©</button>
    </div>
  </div>

  <!-- Progress bar -->
  <div class="mt-4 flex gap-1.5">
    <div class="picker-progress h-1 rounded-full flex-1 bg-[var(--brand-500)]" data-for="1"></div>
    <div class="picker-progress h-1 rounded-full flex-1 bg-[var(--surface-border)]" data-for="2"></div>
    <div class="picker-progress h-1 rounded-full flex-1 bg-[var(--surface-border)]" data-for="3"></div>
  </div>
</div>

<script>
  const answers: Record<string, string> = {};
  let currentStep = 1;

  // Recommendation logic
  function recommend(a: Record<string, string>): { name: string; id: string; reason: string } {
    const { env, budget, priority } = a;

    // Terminal users
    if (env === 'terminal') {
      if (budget === 'free' || budget === 'low') {
        return { name: 'OpenCode + æ–¹èˆŸ Coding Plan', id: 'opencode-ark', reason: 'ç»ˆç«¯åŸç”Ÿ + å›½å†… APIï¼Œä½æˆæœ¬é«˜æ•ˆç‡' };
      }
      return { name: 'Claude Code', id: 'claude-code', reason: 'ç»ˆç«¯æœ€å¼º AI ç¼–ç¨‹ä½“éªŒï¼Œæ”¯æŒå¤š Agent åä½œ' };
    }

    // JetBrains users
    if (env === 'jetbrains') {
      if (priority === 'easy') {
        return { name: 'GitHub Copilot Pro', id: 'copilot-pro', reason: 'JetBrains åŸç”Ÿæ”¯æŒï¼Œå¼€ç®±å³ç”¨' };
      }
      return { name: 'GitHub Copilot Pro', id: 'copilot-pro', reason: 'JetBrains ç”Ÿæ€æœ€æˆç†Ÿçš„ AI ç¼–ç¨‹æ–¹æ¡ˆ' };
    }

    // Free / budget priority
    if (budget === 'free' || priority === 'cheap') {
      if (priority === 'privacy') {
        return { name: 'Aider + Ollama æœ¬åœ°', id: 'aider-ollama', reason: 'å®Œå…¨å…è´¹ + 100% æœ¬åœ°ï¼Œä»£ç ä¸å‡ºæœºå™¨' };
      }
      return { name: 'Cline + æ–¹èˆŸ Coding Plan', id: 'cline-ark', reason: 'Â¥8.9/æœˆèµ·äº«å— Agent çº§ AI ç¼–ç¨‹ï¼Œæ€§ä»·æ¯”ä¹‹ç‹' };
    }

    // China friendly
    if (priority === 'china') {
      if (budget === 'free' || budget === 'low') {
        return { name: 'Cline + æ–¹èˆŸ Coding Plan', id: 'cline-ark', reason: 'å›½å†… API ç›´è¿ï¼Œä½å»¶è¿Ÿ + ä½æˆæœ¬' };
      }
      return { name: 'Trae + æ–¹èˆŸ Coding Plan', id: 'trae-ark', reason: 'å­—èŠ‚å‡ºå“ IDEï¼Œå›½å†…ä½“éªŒæœ€ä¼˜' };
    }

    // Power / best experience
    if (priority === 'power' || budget === 'high') {
      return { name: 'Cursor Pro', id: 'cursor-pro', reason: 'å½“å‰ç»¼åˆä½“éªŒæœ€å¼ºçš„ AI IDEï¼ŒTab è¡¥å…¨ + Agent æ— ç¼åˆ‡æ¢' };
    }

    // Flexibility
    if (priority === 'flex') {
      return { name: 'Cline + æ–¹èˆŸ Coding Plan', id: 'cline-ark', reason: 'è‡ªç”±åˆ‡æ¢æ¨¡å‹å’Œ APIï¼Œæœ€å¤§çµæ´»æ€§' };
    }

    // Privacy
    if (priority === 'privacy') {
      return { name: 'Aider + Ollama æœ¬åœ°', id: 'aider-ollama', reason: 'å®Œå…¨æœ¬åœ°è¿è¡Œï¼Œä»£ç é›¶ä¸Šä¼ ' };
    }

    // Default
    return { name: 'Cline + æ–¹èˆŸ Coding Plan', id: 'cline-ark', reason: 'ç»¼åˆæ€§ä»·æ¯”æœ€ä¼˜çš„å…¥é—¨æ–¹æ¡ˆ' };
  }

  function showStep(step: number | 'result') {
    document.querySelectorAll('.picker-step').forEach(el => el.classList.add('hidden'));
    const target = document.querySelector(`.picker-step[data-step="${step}"]`);
    target?.classList.remove('hidden');

    // Update progress
    document.querySelectorAll('.picker-progress').forEach(el => {
      const forStep = parseInt((el as HTMLElement).dataset.for || '0');
      if (step === 'result' || forStep <= (typeof step === 'number' ? step : 3)) {
        el.classList.remove('bg-[var(--surface-border)]');
        el.classList.add('bg-[var(--brand-500)]');
      } else {
        el.classList.add('bg-[var(--surface-border)]');
        el.classList.remove('bg-[var(--brand-500)]');
      }
    });
  }

  // Option click handlers
  document.querySelectorAll('.picker-option').forEach(btn => {
    btn.addEventListener('click', () => {
      const el = btn as HTMLElement;
      const key = el.dataset.key!;
      const value = el.dataset.value!;
      answers[key] = value;

      // Highlight selected
      el.parentElement?.querySelectorAll('.picker-option').forEach(b => {
        b.classList.remove('btn-primary');
        b.classList.add('btn-ghost');
      });
      el.classList.remove('btn-ghost');
      el.classList.add('btn-primary');

      // Next step after brief delay
      setTimeout(() => {
        if (currentStep < 3) {
          currentStep++;
          showStep(currentStep);
        } else {
          // Show result
          const r = recommend(answers);
          const resultEl = document.getElementById('picker-result');
          const reasonEl = document.getElementById('picker-reason');
          if (resultEl) resultEl.textContent = r.name;
          if (reasonEl) reasonEl.textContent = r.reason;
          showStep('result');

          // Highlight matching card in the page
          document.querySelectorAll('[data-plan-id]').forEach(card => {
            (card as HTMLElement).style.outline = '';
          });
          const matchCard = document.querySelector(`[data-plan-id="${r.id}"]`);
          if (matchCard) {
            (matchCard as HTMLElement).style.outline = '2px solid var(--brand-500)';
            matchCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
      }, 300);
    });
  });

  // Reset
  document.getElementById('picker-reset')?.addEventListener('click', () => {
    Object.keys(answers).forEach(k => delete answers[k]);
    currentStep = 1;
    showStep(1);
    document.querySelectorAll('.picker-option').forEach(b => {
      b.classList.remove('btn-primary');
      b.classList.add('btn-ghost');
    });
    document.querySelectorAll('[data-plan-id]').forEach(card => {
      (card as HTMLElement).style.outline = '';
    });
  });
</script>
