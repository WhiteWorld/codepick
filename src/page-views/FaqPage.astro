---
import BaseLayout from '../layouts/BaseLayout.astro';
import { t, localePath, type Locale } from '../lib/i18n';
import { getFaqs } from '../lib/faq-data';

interface Props { lang: Locale }
const { lang } = Astro.props;

const faqs = getFaqs(lang);

const siteUrl = 'https://codepick.dev';
const pagePath = localePath('/faq', lang);

const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: faqs.map(faq => ({
    '@type': 'Question',
    name: faq.question,
    acceptedAnswer: {
      '@type': 'Answer',
      text: faq.answer,
    },
  })),
};

const breadcrumbSchema = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: t('bread.home', lang), item: siteUrl },
    { '@type': 'ListItem', position: 2, name: 'FAQ', item: `${siteUrl}${pagePath}` },
  ],
};
---

<BaseLayout
  title={t('faq.seoTitle', lang)}
  description={t('faq.seoDesc', lang)}
  jsonLd={[faqSchema, breadcrumbSchema]}
  lang={lang}
>
  <section class="container py-12 max-w-3xl">
    <!-- Breadcrumb -->
    <nav class="text-xs text-[var(--text-muted)] mb-6">
      <a href={localePath('/', lang)} class="hover:text-white no-underline">{t('bread.home', lang)}</a>
      <span class="mx-1">/</span>
      <span class="text-[var(--text-secondary)]">FAQ</span>
    </nav>

    <h1 class="text-3xl font-bold text-white mb-4">{t('faq.title', lang)}</h1>
    <p class="text-[var(--text-secondary)] mb-8">{t('faq.subtitle', lang)}</p>

    <div class="space-y-4">
      {faqs.map((faq, i) => (
        <details class="card group" open={i === 0}>
          <summary class="p-6 cursor-pointer flex items-center justify-between gap-4 list-none">
            <h2 class="text-base font-semibold text-white m-0 leading-snug">{faq.question}</h2>
            <span class="text-[var(--text-muted)] shrink-0 group-open:rotate-180 transition-transform text-lg">â–¾</span>
          </summary>
          <div class="px-6 pb-6 pt-0">
            <p class="text-sm text-[var(--text-secondary)] leading-relaxed m-0">{faq.answer}</p>
          </div>
        </details>
      ))}
    </div>

    <div class="mt-12 card p-6 text-center">
      <p class="text-sm text-[var(--text-secondary)] mb-3">{t('faq.moreQuestions', lang)}</p>
      <a
        href="https://github.com/WhiteWorld/codepick/issues/new"
        target="_blank"
        rel="noopener"
        class="btn btn-primary text-sm no-underline"
      >
        {t('link.submitQuestion', lang)}
      </a>
    </div>
  </section>
</BaseLayout>

<style>
  details summary::-webkit-details-marker {
    display: none;
  }
</style>
