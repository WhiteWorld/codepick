---
import BaseLayout from '../layouts/BaseLayout.astro';
import ToolCard from '../components/ToolCard.astro';
import { getAllToolsLocalized } from '../lib/data';
import { t, localePath, type Locale } from '../lib/i18n';

interface Props { lang: Locale }
const { lang } = Astro.props;

const allTools = getAllToolsLocalized(lang);
const tools = allTools.filter(tool => {
  const plans = (tool as any).pricing?.plans || [];
  return plans.some((p: any) => p.price === 0 || p.price === '0' || p.price === 'free');
}).sort((a, b) => (b.scores.cost_efficiency ?? 0) - (a.scores.cost_efficiency ?? 0));

const siteUrl = 'https://codepick.dev';
const pagePath = localePath('/tools/free', lang);

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'ItemList',
  name: lang === 'zh' ? 'å…è´¹ AI ç¼–ç¨‹å·¥å…·åˆé›†' : 'Free AI Coding Tools Collection',
  url: `${siteUrl}${pagePath}`,
  numberOfItems: tools.length,
  itemListElement: tools.map((tool, i) => ({
    '@type': 'ListItem',
    position: i + 1,
    name: tool.name,
    url: `${siteUrl}${localePath(`/tool/${tool.id}`, lang)}`,
  })),
};

const breadcrumb = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: t('bread.home', lang), item: siteUrl },
    { '@type': 'ListItem', position: 2, name: t('bread.toolLibrary', lang), item: `${siteUrl}${localePath('/tools', lang)}` },
    { '@type': 'ListItem', position: 3, name: t('bread.freeTools', lang), item: `${siteUrl}${pagePath}` },
  ],
};

const seoTitle = lang === 'zh' ? 'å…è´¹ AI ç¼–ç¨‹å·¥å…·åˆé›† | CodePick' : 'Free AI Coding Tools | CodePick';
const seoDesc = lang === 'zh'
  ? `${tools.length} æ¬¾æœ‰å…è´¹ç‰ˆæœ¬çš„ AI ç¼–ç¨‹å·¥å…·æ±‡æ€»ï¼šClineã€Cursorã€Copilotã€Trae ç­‰ï¼ŒåŒ…å«å…è´¹é¢åº¦è¯´æ˜å’Œä½¿ç”¨é™åˆ¶ã€‚`
  : `${tools.length} AI coding tools with free tiers: Cline, Cursor, Copilot, Trae, and more. Including free tier details and limits.`;
---

<BaseLayout title={seoTitle} description={seoDesc} jsonLd={[jsonLd, breadcrumb]} lang={lang}>
  <section class="container py-12">
    <nav class="text-xs text-[var(--text-muted)] mb-6">
      <a href={localePath('/', lang)} class="hover:text-white no-underline">{t('bread.home', lang)}</a>
      <span class="mx-1">/</span>
      <a href={localePath('/tools', lang)} class="hover:text-white no-underline">{t('bread.toolLibrary', lang)}</a>
      <span class="mx-1">/</span>
      <span class="text-[var(--text-secondary)]">{t('bread.freeTools', lang)}</span>
    </nav>

    <h1 class="text-3xl font-bold text-white mb-3">{t('free.title', lang)}</h1>
    <p class="text-[var(--text-secondary)] mb-4 max-w-2xl">
      {t('free.subtitle1', lang)}
      {tools.length} {t('free.subtitle2', lang)}
    </p>

    <div class="card p-4 mb-8 border-l-4 border-[var(--brand-400)]">
      <p class="text-sm text-[var(--text-secondary)] m-0">
        ğŸ’¡ <strong class="text-white">{t('free.twoForms', lang)}</strong>ï¼š
        {t('free.form1', lang)}
        {t('free.form2', lang)}
      </p>
    </div>

    <div class="flex flex-wrap gap-2 mb-8">
      <a href={localePath('/tools', lang)} class="btn btn-ghost text-sm no-underline">{t('cat.all', lang)}</a>
      <span class="btn btn-primary text-sm cursor-default">{t('cat.free', lang)}</span>
      <a href={localePath('/tools/china', lang)} class="btn btn-ghost text-sm no-underline">{t('cat.china', lang)}</a>
      <a href={localePath('/tools/vscode', lang)} class="btn btn-ghost text-sm no-underline">{t('cat.vscode', lang)}</a>
      <a href={localePath('/tools/terminal', lang)} class="btn btn-ghost text-sm no-underline">{t('cat.terminal', lang)}</a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {tools.map(tool => <ToolCard tool={tool} lang={lang} />)}
    </div>

    <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-4">
      <a href={localePath('/faq', lang)} class="card p-5 no-underline group block">
        <h3 class="text-sm font-semibold text-white group-hover:text-[var(--brand-400)] m-0 mb-1">{t('free.relFaq', lang)}</h3>
        <p class="text-xs text-[var(--text-muted)] m-0">{t('free.relFaqDesc', lang)}</p>
      </a>
      <a href={localePath('/guides/ollama-aider-local', lang)} class="card p-5 no-underline group block">
        <h3 class="text-sm font-semibold text-white group-hover:text-[var(--brand-400)] m-0 mb-1">{t('free.relOllama', lang)}</h3>
        <p class="text-xs text-[var(--text-muted)] m-0">{t('free.relOllamaDesc', lang)}</p>
      </a>
    </div>
  </section>
</BaseLayout>
