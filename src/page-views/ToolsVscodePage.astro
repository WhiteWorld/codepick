---
import BaseLayout from '../layouts/BaseLayout.astro';
import ToolCard from '../components/ToolCard.astro';
import { getAllToolsLocalized } from '../lib/data';
import { t, localePath, type Locale } from '../lib/i18n';

interface Props { lang: Locale }
const { lang } = Astro.props;

const allTools = getAllToolsLocalized(lang);
const tools = allTools.filter(tool => {
  const ideBase = ((tool as any).features?.ide_base || '').toLowerCase();
  return ideBase.includes('vs code') || ideBase.includes('vscode');
}).sort((a, b) => (b.scores.coding_ability ?? 0) - (a.scores.coding_ability ?? 0));

const siteUrl = 'https://codepick.dev';
const pagePath = localePath('/tools/vscode', lang);

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'ItemList',
  name: lang === 'zh' ? 'VS Code AI 编程工具' : 'VS Code AI Coding Tools',
  url: `${siteUrl}${pagePath}`,
  numberOfItems: tools.length,
  itemListElement: tools.map((tool, i) => ({
    '@type': 'ListItem',
    position: i + 1,
    name: tool.name,
    url: `${siteUrl}${localePath(`/tool/${tool.id}`, lang)}`,
  })),
};

const breadcrumb = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: t('bread.home', lang), item: siteUrl },
    { '@type': 'ListItem', position: 2, name: t('bread.toolLibrary', lang), item: `${siteUrl}${localePath('/tools', lang)}` },
    { '@type': 'ListItem', position: 3, name: t('bread.vscode', lang), item: `${siteUrl}${pagePath}` },
  ],
};

const seoTitle = lang === 'zh' ? 'VS Code AI 编程工具 | CodePick' : 'VS Code AI Coding Tools | CodePick';
const seoDesc = lang === 'zh'
  ? `${tools.length} 款基于 VS Code 生态的 AI 编程工具：Cursor、Cline、Roo Code、Copilot、Trae，覆盖 VS Code Fork IDE 和 VS Code 插件。`
  : `${tools.length} VS Code-based AI coding tools: Cursor, Cline, Roo Code, Copilot, Trae. Covering VS Code fork IDEs and plugins.`;
---

<BaseLayout title={seoTitle} description={seoDesc} jsonLd={[jsonLd, breadcrumb]} lang={lang}>
  <section class="container py-12">
    <nav class="text-xs text-[var(--text-muted)] mb-6">
      <a href={localePath('/', lang)} class="hover:text-white no-underline">{t('bread.home', lang)}</a>
      <span class="mx-1">/</span>
      <a href={localePath('/tools', lang)} class="hover:text-white no-underline">{t('bread.toolLibrary', lang)}</a>
      <span class="mx-1">/</span>
      <span class="text-[var(--text-secondary)]">{t('bread.vscode', lang)}</span>
    </nav>

    <h1 class="text-3xl font-bold text-white mb-3">{t('vscode.title', lang)}</h1>
    <p class="text-[var(--text-secondary)] mb-4 max-w-2xl">
      {t('vscode.subtitle1', lang)}
      {tools.length} {t('vscode.subtitle2', lang)}
    </p>

    <div class="card p-4 mb-8 grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <p class="text-xs font-semibold text-[var(--text-secondary)] mb-1">{t('vscode.forkTitle', lang)}</p>
        <p class="text-xs text-[var(--text-muted)] m-0">{t('vscode.forkDesc', lang)}</p>
      </div>
      <div>
        <p class="text-xs font-semibold text-[var(--text-secondary)] mb-1">{t('vscode.pluginTitle', lang)}</p>
        <p class="text-xs text-[var(--text-muted)] m-0">{t('vscode.pluginDesc', lang)}</p>
      </div>
    </div>

    <div class="flex flex-wrap gap-2 mb-8">
      <a href={localePath('/tools', lang)} class="btn btn-ghost text-sm no-underline">{t('cat.all', lang)}</a>
      <a href={localePath('/tools/free', lang)} class="btn btn-ghost text-sm no-underline">{t('cat.free', lang)}</a>
      <a href={localePath('/tools/china', lang)} class="btn btn-ghost text-sm no-underline">{t('cat.china', lang)}</a>
      <span class="btn btn-primary text-sm cursor-default">{t('cat.vscode', lang)}</span>
      <a href={localePath('/tools/terminal', lang)} class="btn btn-ghost text-sm no-underline">{t('cat.terminal', lang)}</a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {tools.map(tool => <ToolCard tool={tool} lang={lang} />)}
    </div>

    <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-4">
      <a href={localePath('/compare/cursor-vs-copilot', lang)} class="card p-5 no-underline group block">
        <h3 class="text-sm font-semibold text-white group-hover:text-[var(--brand-400)] m-0 mb-1">{t('vscode.relCursorCopilot', lang)}</h3>
        <p class="text-xs text-[var(--text-muted)] m-0">{t('vscode.relCursorCopilotDesc', lang)}</p>
      </a>
      <a href={localePath('/compare/cline-vs-roo-code', lang)} class="card p-5 no-underline group block">
        <h3 class="text-sm font-semibold text-white group-hover:text-[var(--brand-400)] m-0 mb-1">{t('vscode.relClineRoo', lang)}</h3>
        <p class="text-xs text-[var(--text-muted)] m-0">{t('vscode.relClineRooDesc', lang)}</p>
      </a>
    </div>
  </section>
</BaseLayout>
