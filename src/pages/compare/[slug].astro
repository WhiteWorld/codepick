---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const articles = await getCollection('compare');
  return articles.map(article => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

const { article } = Astro.props;
const { Content } = await article.render();

const siteUrl = 'https://codepick.dev';
const articleUrl = `${siteUrl}/compare/${article.slug}`;

const breadcrumbSchema = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: '首页', item: siteUrl },
    { '@type': 'ListItem', position: 2, name: '对比文章', item: `${siteUrl}/compare` },
    { '@type': 'ListItem', position: 3, name: article.data.title, item: articleUrl },
  ],
};

const articleSchema = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: article.data.title,
  description: article.data.description,
  datePublished: article.data.date,
  dateModified: article.data.date,
  url: articleUrl,
  inLanguage: 'zh-CN',
  author: {
    '@type': 'Organization',
    name: 'CodePick',
    url: siteUrl,
  },
  publisher: {
    '@type': 'Organization',
    name: 'CodePick',
    url: siteUrl,
    logo: { '@type': 'ImageObject', url: `${siteUrl}/favicon.svg` },
  },
};
---

<BaseLayout
  title={`${article.data.title} | CodePick`}
  description={article.data.description}
  jsonLd={[articleSchema, breadcrumbSchema]}
>
  <article class="container py-12 max-w-3xl">
    <!-- Breadcrumb -->
    <nav class="text-xs text-[var(--text-muted)] mb-6">
      <a href="/" class="hover:text-white no-underline">首页</a>
      <span class="mx-1">/</span>
      <a href="/compare" class="hover:text-white no-underline">对比文章</a>
      <span class="mx-1">/</span>
      <span class="text-[var(--text-secondary)]">{article.data.title}</span>
    </nav>

    <!-- Header -->
    <header class="mb-8">
      <div class="flex flex-wrap gap-2 mb-3">
        {article.data.tags?.map((tag: string) => (
          <span class="tag">{tag}</span>
        ))}
      </div>
      <h1 class="text-2xl md:text-3xl font-bold text-white mb-3 mt-0">{article.data.title}</h1>
      <p class="text-[var(--text-secondary)] text-base mb-3">{article.data.description}</p>
      <div class="text-xs text-[var(--text-muted)]">
        发布于 {article.data.date}
      </div>
    </header>

    <!-- Content -->
    <div class="prose prose-invert prose-sm max-w-none
      prose-headings:text-white prose-headings:font-semibold
      prose-h2:text-xl prose-h2:mt-8 prose-h2:mb-4 prose-h2:border-b prose-h2:border-[var(--surface-border)] prose-h2:pb-2
      prose-h3:text-base prose-h3:mt-6 prose-h3:mb-3
      prose-p:text-[var(--text-secondary)] prose-p:leading-relaxed
      prose-a:text-[var(--brand-400)] prose-a:no-underline hover:prose-a:underline
      prose-strong:text-white
      prose-code:text-[var(--brand-300)] prose-code:bg-[var(--surface-card)] prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-xs
      prose-pre:bg-[var(--surface-card)] prose-pre:border prose-pre:border-[var(--surface-border)]
      prose-table:text-sm
      prose-th:text-[var(--text-secondary)] prose-th:font-medium prose-th:bg-[var(--surface-card)]
      prose-td:text-[var(--text-secondary)] prose-td:border-[var(--surface-border)]
      prose-tr:border-[var(--surface-border)]
      prose-blockquote:border-l-[var(--brand-400)] prose-blockquote:text-[var(--text-muted)]
      prose-li:text-[var(--text-secondary)]
      prose-hr:border-[var(--surface-border)]
    ">
      <Content />
    </div>

    <!-- Back link -->
    <div class="mt-12 pt-6 border-t border-[var(--surface-border)]">
      <a href="/compare" class="text-sm text-[var(--brand-400)] no-underline hover:underline">← 返回对比文章列表</a>
    </div>
  </article>
</BaseLayout>
