---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ScoreBar from '../../components/ScoreBar.astro';
import { getAllPlans, getTool, getApi, overallScore } from '../../lib/data';
import type { Plan } from '../../lib/data';

export function getStaticPaths() {
  const plans = getAllPlans();
  return plans.map(plan => ({
    params: { id: plan.id },
    props: { plan },
  }));
}

interface Props { plan: Plan }
const { plan } = Astro.props;

const clientTool = getTool(plan.client);
const apiSource = getApi(plan.api);
const overall = overallScore(plan.scores);
const bestFor = plan.best_for || [];
const quickStart = plan.quick_start || [];
const pros = plan.pros || [];
const cons = plan.cons || [];
const tags = plan.tags || [];
---

<BaseLayout title={`${plan.name} æ–¹æ¡ˆè¯¦è§£ | CodePick`} description={plan.tagline || ''}>
  <article class="container py-12 max-w-4xl">
    <!-- Breadcrumb -->
    <nav class="text-xs text-[var(--text-muted)] mb-6">
      <a href="/" class="hover:text-white no-underline">é¦–é¡µ</a>
      <span class="mx-1">/</span>
      <span class="text-[var(--text-secondary)]">{plan.name}</span>
    </nav>

    <!-- Header -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-2">
        <h1 class="text-2xl md:text-3xl font-bold text-white m-0">{plan.name}</h1>
        {plan.badge && <span class="badge text-sm">{plan.badge}</span>}
      </div>
      <p class="text-[var(--text-secondary)] m-0 mb-4">{plan.tagline}</p>
      <div class="flex items-center gap-4">
        <span class="text-2xl font-bold text-white">{plan.monthly_cost}</span>
        <span class="text-[var(--text-muted)]">{plan.currency}/æœˆ</span>
        <span class="text-[var(--text-muted)]">Â·</span>
        <span class="tag tag-primary">ç»¼åˆ {overall}</span>
      </div>
    </div>

    <!-- Scores -->
    <section class="card p-6 mb-8">
      <h2 class="text-lg font-semibold text-white mb-4 mt-0">ğŸ“Š æ–¹æ¡ˆè¯„åˆ†</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="flex flex-col gap-3">
          <ScoreBar label="ç¼–ç¨‹èƒ½åŠ›" score={plan.scores.coding_ability} color="auto" />
          <ScoreBar label="æ€§ä»·æ¯”" score={plan.scores.cost_efficiency} color="auto" />
        </div>
        <div class="flex flex-col gap-3">
          <ScoreBar label="çµæ´»æ€§" score={plan.scores.flexibility} color="auto" />
          <ScoreBar label="å›½å†…ä½“éªŒ" score={plan.scores.china_friendly} color="auto" />
        </div>
      </div>
    </section>

    <!-- Composition -->
    <section class="card p-6 mb-8">
      <h2 class="text-lg font-semibold text-white mb-4 mt-0">ğŸ§© æ–¹æ¡ˆç»„æˆ</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-[var(--surface-hover)] rounded-lg p-4">
          <div class="text-xs text-[var(--text-muted)] mb-1">å®¢æˆ·ç«¯</div>
          <div class="font-semibold text-white">{clientTool?.name || plan.client}</div>
          {clientTool && (
            <a href={`/tool/${clientTool.id}`} class="text-xs text-[var(--brand-400)] no-underline">æŸ¥çœ‹è¯¦æƒ… â†’</a>
          )}
        </div>
        <div class="bg-[var(--surface-hover)] rounded-lg p-4">
          <div class="text-xs text-[var(--text-muted)] mb-1">æ¨¡å‹ API</div>
          <div class="font-semibold text-white">{apiSource?.name || plan.api}</div>
          {apiSource && (
            <span class="text-xs text-[var(--text-muted)]">{apiSource.provider}</span>
          )}
        </div>
        <div class="bg-[var(--surface-hover)] rounded-lg p-4">
          <div class="text-xs text-[var(--text-muted)] mb-1">è¿è¡Œç¯å¢ƒ</div>
          <div class="font-semibold text-white">{plan.environment || 'â€”'}</div>
          <span class="text-xs text-[var(--text-muted)]">é…ç½®éš¾åº¦: {plan.setup_difficulty}</span>
        </div>
      </div>
    </section>

    <!-- Quick Start -->
    {quickStart.length > 0 && (
      <section class="card p-6 mb-8">
        <h2 class="text-lg font-semibold text-white mb-4 mt-0">ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
        <ol class="list-decimal list-inside text-sm text-[var(--text-secondary)] space-y-2 m-0 pl-0">
          {quickStart.map(step => <li>{step}</li>)}
        </ol>
      </section>
    )}

    <!-- Pros & Cons -->
    {(pros.length > 0 || cons.length > 0) && (
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
        {pros.length > 0 && (
          <div class="card p-6">
            <h3 class="text-base font-semibold text-green-400 mb-3 mt-0">âœ… ä¼˜åŠ¿</h3>
            <ul class="list-none text-sm text-[var(--text-secondary)] space-y-1.5 m-0 p-0">
              {pros.map(p => <li>+ {p}</li>)}
            </ul>
          </div>
        )}
        {cons.length > 0 && (
          <div class="card p-6">
            <h3 class="text-base font-semibold text-red-400 mb-3 mt-0">âš ï¸ åŠ£åŠ¿</h3>
            <ul class="list-none text-sm text-[var(--text-secondary)] space-y-1.5 m-0 p-0">
              {cons.map(c => <li>- {c}</li>)}
            </ul>
          </div>
        )}
      </div>
    )}

    <!-- Best For -->
    {bestFor.length > 0 && (
      <section class="card p-6 mb-8">
        <h2 class="text-lg font-semibold text-white mb-4 mt-0">ğŸ¯ æœ€é€‚åˆ</h2>
        <div class="flex flex-wrap gap-2">
          {bestFor.map(b => <span class="tag tag-primary">{b}</span>)}
        </div>
      </section>
    )}

    <!-- Tags -->
    {tags.length > 0 && (
      <div class="flex flex-wrap gap-2 mb-8">
        {tags.map(t => <span class="tag">{t}</span>)}
      </div>
    )}
  </article>
</BaseLayout>
